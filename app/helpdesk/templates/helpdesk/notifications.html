{% extends "base.html" %}
{% block title %}{{ 'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª' if session.get('lang') == 'ar' else 'Notifications' }}{% endblock %}
{% block content %}
{% set ar = session.get('lang') == 'ar' %}

<div class="page-header">
  <div>
    <h1 class="page-title">{{ 'Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª' if ar else 'Notifications' }}</h1>
    <p class="page-subtitle">
      {% set unread_count = notifs | selectattr('is_read', 'equalto', false) | list | length %}
      {% if unread_count > 0 %}
        {{ unread_count }} {{ 'Ø¥Ø´Ø¹Ø§Ø± ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡' if ar else 'unread notification' }}{{ '' if unread_count == 1 else ('Ø§Øª' if ar else 's') }}
      {% else %}
        {{ 'ÙƒÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù‚Ø±ÙˆØ¡Ø©' if ar else 'All caught up' }}
      {% endif %}
    </p>
  </div>
  {% if notifs | selectattr('is_read', 'equalto', false) | list | length > 0 %}
  <form method="POST" action="{{ url_for('helpdesk.mark_all_read') }}">
    <button type="submit" class="btn btn-outline">
      âœ“ {{ 'ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡' if ar else 'Mark All Read' }}
    </button>
  </form>
  {% endif %}
</div>

{% if notifs %}
<div class="table-card" style="overflow:hidden;">
  {% for n in notifs %}
  <div class="notification-item {% if not n.is_read %}unread{% endif %}">
    <div class="notification-dot {% if n.is_read %}read{% endif %}"></div>
    <div style="flex:1;min-width:0;">
      <div style="font-size:0.875rem;font-weight:{% if not n.is_read %}600{% else %}500{% endif %};margin-bottom:0.2rem;">
        {{ n.title_ar if ar and n.title_ar else n.title }}
      </div>
      {% set body = n.body_ar if ar and n.body_ar else n.body %}
      {% if body %}
      <div style="font-size:0.82rem;color:var(--text-muted);margin-bottom:0.3rem;
                  overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:600px;">
        {{ body }}
      </div>
      {% endif %}
      <div style="font-size:0.75rem;color:var(--text-faint);">
        {{ n.created_at.strftime('%d %b %Y, %I:%M %p') }}
      </div>
    </div>
    <div style="display:flex;gap:0.5rem;align-items:center;flex-shrink:0;">
      {% if n.link %}
      <a href="{{ n.link }}" class="btn btn-ghost btn-sm">
        {{ 'â† Ø¹Ø±Ø¶' if ar else 'View â†’' }}
      </a>
      {% endif %}
      {% if not n.is_read %}
      <form method="POST" action="{{ url_for('helpdesk.mark_read', id=n.id) }}" style="margin:0;">
        <button type="submit" class="btn btn-outline btn-sm">
          {{ 'ØªØ¹ÙŠÙŠÙ† ÙƒÙ…Ù‚Ø±ÙˆØ¡' if ar else 'Mark Read' }}
        </button>
      </form>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="empty-state">
  <div class="empty-icon">ğŸ””</div>
  <h3>{{ 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª' if ar else 'No notifications' }}</h3>
  <p>{{ 'Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¥Ø´Ø¹Ø§Ø±Ø§ØªÙƒ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„Ù‡Ø§.' if ar else 'Your notifications will appear here.' }}</p>
</div>
{% endif %}

{% endblock %}
