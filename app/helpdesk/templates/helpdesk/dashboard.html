{% extends "base.html" %}
{% block title %}{{ 'ØªØ°Ø§ÙƒØ±ÙŠ â€” Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©' if session.get('lang') == 'ar' else 'My Tickets â€” Help Desk' }}{% endblock %}
{% block content %}
{% set ar = session.get('lang') == 'ar' %}

<div class="page-header">
  <div>
    <h1 class="page-title">{{ 'ØªØ°Ø§ÙƒØ±ÙŠ' if ar else 'My Tickets' }}</h1>
    <p class="page-subtitle">{{ 'ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ØªÙŠ Ù‚Ø¯Ù…ØªÙ‡Ø§' if ar else 'Your support ticket history' }}</p>
  </div>
  <a href="{{ url_for('helpdesk.new_ticket') }}" class="btn btn-primary">
    + {{ 'ØªØ°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©' if ar else 'New Ticket' }}
  </a>
</div>

<div class="filter-tabs">
  {% for s, label_en, label_ar in [
      ('all','All','Ø§Ù„ÙƒÙ„'),
      ('open','Open','Ù…ÙØªÙˆØ­'),
      ('in_progress','In Progress','Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'),
      ('resolved','Resolved','Ù…Ø­Ù„ÙˆÙ„'),
      ('closed','Closed','Ù…ØºÙ„Ù‚')
  ] %}
  <a href="{{ url_for('helpdesk.dashboard', status=s) }}"
     class="filter-tab {% if status_filter == s %}active{% endif %}">
    {{ label_ar if ar else label_en }}
  </a>
  {% endfor %}
</div>

{% if tickets %}
<div class="table-card">
  <table class="table">
    <thead>
      <tr>
        <th>{{ 'Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©' if ar else 'Ticket No.' }}</th>
        <th>{{ 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†' if ar else 'Title' }}</th>
        <th>{{ 'Ø§Ù„ÙØ¦Ø©' if ar else 'Category' }}</th>
        <th>{{ 'Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©' if ar else 'Priority' }}</th>
        <th>{{ 'Ø§Ù„Ø­Ø§Ù„Ø©' if ar else 'Status' }}</th>
        <th>{{ 'Ø§Ù„ØªØ§Ø±ÙŠØ®' if ar else 'Created' }}</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for t in tickets %}
      <tr>
        <td><span class="mono" style="font-weight:700;color:var(--accent);">{{ t.ticket_number }}</span></td>
        <td>{{ t.title_ar if ar and t.title_ar else t.title }}</td>
        <td>{{ t.category.name_ar if ar and t.category.name_ar else t.category.name }}</td>
        <td><span class="badge {{ t.priority_badge_class() }}">
          {% if ar %}
            {% if t.priority == 'low' %}Ù…Ù†Ø®ÙØ¶Ø©{% elif t.priority == 'normal' %}Ø¹Ø§Ø¯ÙŠØ©{% elif t.priority == 'high' %}Ø¹Ø§Ù„ÙŠØ©{% else %}Ø¹Ø§Ø¬Ù„Ø©{% endif %}
          {% else %}
            {{ t.priority | title }}
          {% endif %}
        </span></td>
        <td><span class="badge {{ t.status_badge_class() }}">
          {% if ar %}
            {% if t.status == 'open' %}Ù…ÙØªÙˆØ­{% elif t.status == 'in_progress' %}Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©{% elif t.status == 'resolved' %}Ù…Ø­Ù„ÙˆÙ„{% else %}Ù…ØºÙ„Ù‚{% endif %}
          {% else %}
            {{ t.status.replace('_',' ') | title }}
          {% endif %}
        </span></td>
        <td style="color:var(--text-muted);font-size:0.82rem;">{{ t.created_at.strftime('%d %b %Y') }}</td>
        <td>
          <a href="{{ url_for('helpdesk.ticket_detail', id=t.id) }}" class="btn btn-ghost btn-sm">
            {{ 'â†' if ar else 'â†’' }}
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="empty-state">
  <div class="empty-icon">ğŸ«</div>
  <h3>{{ 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ±' if ar else 'No tickets yet' }}</h3>
  <p>{{ 'Ù„Ù… ØªÙ‚Ø¯Ù… Ø£ÙŠ ØªØ°Ø§ÙƒØ± Ø¯Ø¹Ù… Ø¨Ø¹Ø¯.' if ar else 'You have not submitted any support tickets yet.' }}</p>
  <a href="{{ url_for('helpdesk.new_ticket') }}" class="btn btn-primary" style="margin-top:1rem;">
    {{ 'ØªÙ‚Ø¯ÙŠÙ… ØªØ°ÙƒØ±Ø©' if ar else 'Submit a Ticket' }}
  </a>
</div>
{% endif %}

{% endblock %}
