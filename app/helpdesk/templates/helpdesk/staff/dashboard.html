{% extends "base.html" %}
{% block title %}{{ 'Ù„ÙˆØ­Ø© Ø§Ù„Ø¯Ø¹Ù…' if session.get('lang') == 'ar' else 'Staff Panel â€” Help Desk' }}{% endblock %}
{% block content %}
{% set ar = session.get('lang') == 'ar' %}

<div class="page-header">
  <div>
    <h1 class="page-title">
      {{ 'Ù„ÙˆØ­Ø© Ø§Ù„Ø¯Ø¹Ù…' if ar else 'Staff Panel' }}
      {% if department != 'All' %}
      <span style="font-size:1rem;font-weight:400;color:var(--text-muted);">â€” {{ department }}</span>
      {% endif %}
    </h1>
    <p class="page-subtitle">{{ 'Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‚Ø³Ù…Ùƒ' if ar else 'Tickets assigned to your department' }}</p>
  </div>
</div>

<!-- Status filter tabs -->
<div class="filter-tabs">
  {% for s, label_en, label_ar in [
      ('all','All','Ø§Ù„ÙƒÙ„'),
      ('open','Open','Ù…ÙØªÙˆØ­'),
      ('in_progress','In Progress','Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'),
      ('resolved','Resolved','Ù…Ø­Ù„ÙˆÙ„'),
      ('closed','Closed','Ù…ØºÙ„Ù‚')
  ] %}
  <a href="{{ url_for('helpdesk.staff_dashboard', status=s, priority=priority_filter) }}"
     class="filter-tab {% if status_filter == s %}active{% endif %}">
    {{ label_ar if ar else label_en }}
  </a>
  {% endfor %}
</div>

<!-- Priority filter -->
<div style="display:flex;gap:0.5rem;margin-bottom:1.25rem;flex-wrap:wrap;">
  <span style="font-size:0.78rem;font-weight:600;color:var(--text-muted);align-self:center;">
    {{ 'Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:' if ar else 'Priority:' }}
  </span>
  {% for p, label_en, label_ar in [
      ('all','All','Ø§Ù„ÙƒÙ„'),
      ('urgent','Urgent','Ø¹Ø§Ø¬Ù„Ø©'),
      ('high','High','Ø¹Ø§Ù„ÙŠØ©'),
      ('normal','Normal','Ø¹Ø§Ø¯ÙŠØ©'),
      ('low','Low','Ù…Ù†Ø®ÙØ¶Ø©')
  ] %}
  <a href="{{ url_for('helpdesk.staff_dashboard', status=status_filter, priority=p) }}"
     class="btn btn-sm {% if priority_filter == p %}btn-primary{% else %}btn-outline{% endif %}">
    {{ label_ar if ar else label_en }}
  </a>
  {% endfor %}
</div>

{% if tickets %}
<div class="table-card">
  <table class="table">
    <thead>
      <tr>
        <th>{{ 'Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©' if ar else 'Ticket No.' }}</th>
        <th>{{ 'Ù…Ù‚Ø¯Ù… Ø¨ÙˆØ§Ø³Ø·Ø©' if ar else 'Requester' }}</th>
        <th>{{ 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†' if ar else 'Title' }}</th>
        <th>{{ 'Ø§Ù„ÙØ¦Ø©' if ar else 'Category' }}</th>
        <th>{{ 'Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©' if ar else 'Priority' }}</th>
        <th>{{ 'Ø§Ù„Ø­Ø§Ù„Ø©' if ar else 'Status' }}</th>
        <th>{{ 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«' if ar else 'Updated' }}</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for t in tickets %}
      <tr>
        <td><span class="mono" style="font-weight:700;color:var(--accent);">{{ t.ticket_number }}</span></td>
        <td style="font-size:0.875rem;">{{ t.created_by_name_ar if ar and t.created_by_name_ar else t.created_by_name }}</td>
        <td>{{ t.title_ar if ar and t.title_ar else t.title }}</td>
        <td style="font-size:0.82rem;color:var(--text-muted);">
          {{ t.category.name_ar if ar and t.category.name_ar else t.category.name }}
        </td>
        <td><span class="badge {{ t.priority_badge_class() }}">
          {% if ar %}
            {% if t.priority == 'low' %}Ù…Ù†Ø®ÙØ¶Ø©{% elif t.priority == 'normal' %}Ø¹Ø§Ø¯ÙŠØ©{% elif t.priority == 'high' %}Ø¹Ø§Ù„ÙŠØ©{% else %}Ø¹Ø§Ø¬Ù„Ø©{% endif %}
          {% else %}
            {{ t.priority | title }}
          {% endif %}
        </span></td>
        <td><span class="badge {{ t.status_badge_class() }}">
          {% if ar %}
            {% if t.status == 'open' %}Ù…ÙØªÙˆØ­{% elif t.status == 'in_progress' %}Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©{% elif t.status == 'resolved' %}Ù…Ø­Ù„ÙˆÙ„{% else %}Ù…ØºÙ„Ù‚{% endif %}
          {% else %}
            {{ t.status.replace('_',' ') | title }}
          {% endif %}
        </span></td>
        <td style="color:var(--text-muted);font-size:0.82rem;">{{ t.updated_at.strftime('%d %b %Y') }}</td>
        <td>
          <a href="{{ url_for('helpdesk.ticket_detail', id=t.id) }}" class="btn btn-ghost btn-sm">
            {{ 'â† Ø¹Ø±Ø¶' if ar else 'View â†’' }}
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="empty-state">
  <div class="empty-icon">ğŸ«</div>
  <h3>{{ 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ±' if ar else 'No tickets' }}</h3>
  <p>{{ 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°Ø§ÙƒØ± ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø±Ø´Ø­Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©.' if ar else 'No tickets match the current filters.' }}</p>
</div>
{% endif %}

{% endblock %}
