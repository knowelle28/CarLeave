{% extends "base.html" %}
{% block title %}{{ 'ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù…' if session.get('lang') == 'ar' else 'Help Desk Staff' }}{% endblock %}
{% block content %}
{% set ar = session.get('lang') == 'ar' %}

<div class="page-header">
  <div>
    <h1 class="page-title">{{ 'ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù…' if ar else 'Help Desk Staff' }}</h1>
    <p class="page-subtitle">{{ 'Ø¥Ø¯Ø§Ø±Ø© Ø£Ø¹Ø¶Ø§Ø¡ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù…' if ar else 'Manage support staff members' }}</p>
  </div>
  <a href="{{ url_for('helpdesk.admin_dashboard') }}" class="btn btn-ghost">
    {{ 'â†’ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©' if ar else 'â† Admin Dashboard' }}
  </a>
</div>

{% if staff_members %}
<div class="table-card" style="margin-bottom:2rem;">
  <table class="table">
    <thead>
      <tr>
        <th>{{ 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' if ar else 'Username' }}</th>
        <th>{{ 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„' if ar else 'Full Name' }}</th>
        <th>{{ 'Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' if ar else 'Name (AR)' }}</th>
        <th>{{ 'Ø§Ù„Ù‚Ø³Ù…' if ar else 'Department' }}</th>
        <th>{{ 'Ø§Ù„Ø­Ø§Ù„Ø©' if ar else 'Status' }}</th>
        <th>{{ 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©' if ar else 'Added' }}</th>
        <th>{{ 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª' if ar else 'Actions' }}</th>
      </tr>
    </thead>
    <tbody>
      {% for s in staff_members %}
      <tr>
        <td class="mono" style="font-weight:600;">{{ s.username }}</td>
        <td>{{ s.full_name }}</td>
        <td style="font-family:'Noto Naskh Arabic',sans-serif;">{{ s.full_name_ar or 'â€”' }}</td>
        <td>{{ s.department }}</td>
        <td>
          <span class="badge {% if s.is_active %}badge-approved{% else %}badge-draft{% endif %}">
            {{ ('Ù†Ø´Ø·' if s.is_active else 'Ù…Ø¹Ø·Ù„') if ar else ('Active' if s.is_active else 'Inactive') }}
          </span>
        </td>
        <td style="font-size:0.82rem;color:var(--text-muted);">{{ s.added_at.strftime('%d %b %Y') }}</td>
        <td>
          <form method="POST" action="{{ url_for('helpdesk.admin_toggle_staff', id=s.id) }}" style="margin:0;">
            <button type="submit" class="btn btn-ghost btn-sm">
              {{ ('Ø¥ÙŠÙ‚Ø§Ù' if s.is_active else 'ØªÙØ¹ÙŠÙ„') if ar else ('Deactivate' if s.is_active else 'Activate') }}
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="empty-state" style="padding:3rem 2rem;">
  <div class="empty-icon">ğŸ‘¥</div>
  <h3>{{ 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ ÙØ±ÙŠÙ‚' if ar else 'No staff members yet' }}</h3>
  <p>{{ 'Ø£Ø¶Ù Ø£ÙˆÙ„ Ø¹Ø¶Ùˆ ÙÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ Ø£Ø¯Ù†Ø§Ù‡.' if ar else 'Add your first staff member below.' }}</p>
</div>
{% endif %}

<!-- Add Staff form -->
<div class="form-card" style="max-width:640px;">
  <div class="detail-card-title">{{ 'Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ø¬Ø¯ÙŠØ¯' if ar else 'Add Staff Member' }}</div>

  {% if departments %}
  <form method="POST" action="{{ url_for('helpdesk.admin_add_staff') }}">
    <div class="form-row-2">
      <div class="form-group">
        <label class="form-label">{{ 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' if ar else 'Username' }} <span class="required">*</span></label>
        <input class="form-input mono" type="text" name="username"
               placeholder="{{ 'Ù…Ø«Ø§Ù„: john.smith' if ar else 'e.g. john.smith' }}" required>
      </div>
      <div class="form-group">
        <label class="form-label">{{ 'Ø§Ù„Ù‚Ø³Ù…' if ar else 'Department' }} <span class="required">*</span></label>
        <select class="form-input form-select" name="department" required>
          <option value="" disabled selected>â€” {{ 'Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…' if ar else 'Select department' }} â€”</option>
          {% for d in departments %}
          <option value="{{ d }}">{{ d }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <div class="form-row-2">
      <div class="form-group">
        <label class="form-label">{{ 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„' if ar else 'Full Name' }} <span class="required">*</span></label>
        <input class="form-input" type="text" name="full_name"
               placeholder="{{ 'Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯' if ar else 'e.g. John Smith' }}" required>
      </div>
      <div class="form-group">
        <label class="form-label">{{ 'Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' if ar else 'Name (Arabic)' }}</label>
        <input class="form-input rtl-input" type="text" name="full_name_ar"
               placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">
      </div>
    </div>
    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        + {{ 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ' if ar else 'Add Staff Member' }}
      </button>
    </div>
  </form>
  {% else %}
  <div style="padding:1rem;background:var(--surface-2);border-radius:var(--radius);font-size:0.875rem;color:var(--text-muted);">
    âš ï¸ {{ 'ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© Ù†Ø´Ø·Ø© Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚.' if ar
         else 'You must add at least one active category before adding staff members.' }}
    <a href="{{ url_for('helpdesk.admin_categories') }}" class="btn btn-outline btn-sm" style="margin-{{ 'right' if ar else 'left' }}:0.5rem;">
      {{ 'Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©' if ar else 'Add Category' }}
    </a>
  </div>
  {% endif %}
</div>

{% endblock %}
