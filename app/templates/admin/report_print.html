<!DOCTYPE html>
<html lang="{{ session.get('lang', 'en') }}" dir="{{ 'rtl' if session.get('lang') == 'ar' else 'ltr' }}">
<head>
<meta charset="UTF-8">
<title>{{ report_title }} â€” Leave Report</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: Arial, sans-serif;
    font-size: 11pt;
    color: #000;
    padding: 20mm 15mm;
  }
  .report-header {
    border-bottom: 2px solid #000;
    padding-bottom: 10px;
    margin-bottom: 16px;
  }
  .report-header h1 {
    font-size: 16pt;
    font-weight: bold;
    margin-bottom: 4px;
  }
  .report-meta {
    font-size: 9pt;
    color: #444;
    display: flex;
    gap: 24px;
    flex-wrap: wrap;
    margin-top: 6px;
  }
  .report-meta span { display: inline-block; }
  .report-stats {
    display: flex;
    gap: 32px;
    margin-bottom: 14px;
    padding: 8px 12px;
    background: #f5f5f5;
    border: 1px solid #ddd;
    font-size: 10pt;
  }
  .stat-item { display: flex; flex-direction: column; }
  .stat-val { font-size: 14pt; font-weight: bold; }
  .stat-label { font-size: 8pt; color: #555; text-transform: uppercase; }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 9.5pt;
    margin-top: 8px;
  }
  thead tr {
    background: #222;
    color: #fff;
  }
  thead th {
    padding: 7px 8px;
    text-align: left;
    font-weight: bold;
    font-size: 8.5pt;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    white-space: nowrap;
  }
  tbody tr { border-bottom: 1px solid #e0e0e0; }
  tbody tr:nth-child(even) { background: #f9f9f9; }
  tbody tr:last-child { border-bottom: 2px solid #000; }
  tbody td {
    padding: 6px 8px;
    vertical-align: top;
  }
  .td-mono { font-family: monospace; font-size: 9pt; }
  .status-pill {
    display: inline-block;
    padding: 1px 7px;
    border-radius: 99px;
    font-size: 8pt;
    font-weight: bold;
    border: 1px solid #ccc;
  }
  .s-draft    { border-color: #9ca3af; color: #374151; background: #f3f4f6; }
  .s-pending  { border-color: #f59e0b; color: #92400e; background: #fef3c7; }
  .s-approved { border-color: #22c55e; color: #166534; background: #dcfce7; }
  .s-archived { border-color: #9ca3af; color: #374151; background: #f3f4f6; }
  .report-footer {
    margin-top: 20px;
    border-top: 1px solid #ccc;
    padding-top: 8px;
    font-size: 8pt;
    color: #666;
    display: flex;
    justify-content: space-between;
  }
  @media print {
    body { padding: 10mm 10mm; }
    .no-print { display: none !important; }
  }
</style>
</head>
<body>
{% set ar = session.get('lang') == 'ar' %}

<!-- Print toolbar (hidden when printing) -->
<div class="no-print" style="margin-bottom:16px;">
  <button onclick="window.print()" style="padding:8px 20px;font-size:10pt;cursor:pointer;
    background:#222;color:#fff;border:none;border-radius:4px;margin-right:8px;">
    ğŸ–¨ {{ 'Ø·Ø¨Ø§Ø¹Ø©' if ar else 'Print' }}
  </button>
  <button onclick="window.close()" style="padding:8px 20px;font-size:10pt;cursor:pointer;
    background:#eee;color:#222;border:1px solid #ccc;border-radius:4px;">
    {{ 'Ø¥ØºÙ„Ø§Ù‚' if ar else 'Close' }}
  </button>
</div>

<!-- Header -->
<div class="report-header">
  <h1>{{ 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø© â€” ' if ar else 'Leave Report â€” ' }}{{ report_title }}</h1>
  <div class="report-meta">
    <span>{{ 'Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ' if ar else 'Report Type: ' }}
      <strong>
        {% if report_type == 'employee' %}{{ 'Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¸Ù' if ar else 'By Employee' }}
        {% elif report_type == 'department' %}{{ 'Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…' if ar else 'By Department' }}
        {% else %}{{ 'Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ±' if ar else 'By Manager' }}{% endif %}
      </strong>
    </span>
    {% if status_filter != 'all' %}
    <span>{{ 'Ø§Ù„Ø­Ø§Ù„Ø©: ' if ar else 'Status: ' }}
      <strong>
        {% if status_filter == 'draft' %}{{ 'Ù…Ø³ÙˆØ¯Ø©' if ar else 'Draft' }}
        {% elif status_filter == 'pending' %}{{ 'Ù…Ø¹Ù„Ù‚' if ar else 'Pending' }}
        {% elif status_filter == 'approved' %}{{ 'Ù…Ø¹ØªÙ…Ø¯' if ar else 'Approved' }}
        {% elif status_filter == 'archived' %}{{ 'Ù…Ø¤Ø±Ø´Ù' if ar else 'Archived' }}
        {% else %}{{ status_filter }}{% endif %}
      </strong>
    </span>
    {% endif %}
    {% if date_from or date_to %}
    <span>{{ 'Ø§Ù„ÙØªØ±Ø©: ' if ar else 'Period: ' }}
      <strong>{{ date_from or 'â€¦' }} â†’ {{ date_to or 'today' }}</strong>
    </span>
    {% endif %}
    <span>{{ 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ' if ar else 'Printed: ' }}
      <strong>{{ now.strftime('%d %b %Y, %I:%M %p') }}</strong>
    </span>
  </div>
</div>

<!-- Stats -->
<div class="report-stats">
  <div class="stat-item">
    <span class="stat-val">{{ stats.total }}</span>
    <span class="stat-label">{{ 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ' if ar else 'Total' }}</span>
  </div>
  <div class="stat-item">
    <span class="stat-val">{{ stats.approved }}</span>
    <span class="stat-label">{{ 'Ù…Ø¹ØªÙ…Ø¯' if ar else 'Approved' }}</span>
  </div>
  <div class="stat-item">
    <span class="stat-val">{{ stats.pending }}</span>
    <span class="stat-label">{{ 'Ù…Ø¹Ù„Ù‚' if ar else 'Pending' }}</span>
  </div>
  <div class="stat-item">
    <span class="stat-val">{{ stats.draft }}</span>
    <span class="stat-label">{{ 'Ù…Ø³ÙˆØ¯Ø©' if ar else 'Draft' }}</span>
  </div>
  <div class="stat-item">
    <span class="stat-val">{{ stats.archived }}</span>
    <span class="stat-label">{{ 'Ù…Ø¤Ø±Ø´Ù' if ar else 'Archived' }}</span>
  </div>
  <div class="stat-item">
    <span class="stat-val">{{ stats.avg_duration }}</span>
    <span class="stat-label">{{ 'Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£ÙŠØ§Ù…' if ar else 'Avg. Days' }}</span>
  </div>
</div>

<!-- Table -->
<table>
  <thead>
    <tr>
      <th>#</th>
      <th>{{ 'Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨' if ar else 'Request No.' }}</th>
      {% if not (report_type == 'employee' and selected_id != 'all') %}
      <th>{{ 'Ø§Ù„Ù…ÙˆØ¸Ù' if ar else 'Employee' }}</th>
      {% endif %}
      {% if not (report_type == 'department' and selected_id != 'all') %}
      <th>{{ 'Ø§Ù„Ù‚Ø³Ù…' if ar else 'Dept.' }}</th>
      {% endif %}
      {% if not (report_type == 'manager' and selected_id != 'all') %}
      <th>{{ 'Ø§Ù„Ù…Ø¯ÙŠØ±' if ar else 'Manager' }}</th>
      {% endif %}
      <th>{{ 'Ø§Ù„ÙˆØ¬Ù‡Ø©' if ar else 'Destination' }}</th>
      <th>{{ 'Ø§Ù„Ø³Ø¨Ø¨' if ar else 'Reason' }}</th>
      <th>{{ 'Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©' if ar else 'Departure' }}</th>
      <th>{{ 'Ø§Ù„Ø¹ÙˆØ¯Ø©' if ar else 'Return' }}</th>
      <th>{{ 'Ø§Ù„Ù…Ø¯Ø©' if ar else 'Duration' }}</th>
      <th>{{ 'Ø§Ù„Ø­Ø§Ù„Ø©' if ar else 'Status' }}</th>
    </tr>
  </thead>
  <tbody>
    {% for r in records %}
    <tr>
      <td>{{ loop.index }}</td>
      <td class="td-mono">{{ r.request_number }}</td>
      {% if not (report_type == 'employee' and selected_id != 'all') %}
      <td>
        {{ r.employee_name_ar if ar and r.employee_name_ar else r.employee_name }}
        {% if r.employee_number %}
        <br><span style="font-size:8pt;color:#666;">{{ r.employee_number }}</span>
        {% endif %}
      </td>
      {% endif %}
      {% if not (report_type == 'department' and selected_id != 'all') %}
      <td>{{ (r.employee_department_ar if ar and r.employee_department_ar else r.employee_department) or 'â€”' }}</td>
      {% endif %}
      {% if not (report_type == 'manager' and selected_id != 'all') %}
      <td>{{ (r.manager_name_ar if ar and r.manager_name_ar else r.manager_name) or 'â€”' }}</td>
      {% endif %}
      <td>{{ (r.destination_ar if ar and r.destination_ar else r.destination) or 'â€”' }}</td>
      <td style="max-width:120px;font-size:8.5pt;color:#444;">
        {% set reason_text = r.reason_ar if ar and r.reason_ar else r.reason %}
        {{ reason_text[:60] }}{% if reason_text|length > 60 %}â€¦{% endif %}
      </td>
      <td style="white-space:nowrap;font-size:8.5pt;">
        {{ r.departure_datetime.strftime('%d %b %Y %I:%M%p') }}
      </td>
      <td style="white-space:nowrap;font-size:8.5pt;">
        {{ r.return_datetime.strftime('%d %b %Y %I:%M%p') }}
      </td>
      <td style="white-space:nowrap;">
        {% set diff = r.return_datetime - r.departure_datetime %}
        {% set total_h = (diff.total_seconds() // 3600)|int %}
        {% set days = (total_h // 24)|int %}
        {% set hrs  = (total_h % 24)|int %}
        {% if days > 0 %}{{ days }}d {% endif %}{% if hrs > 0 %}{{ hrs }}h{% endif %}{% if days == 0 and hrs == 0 %}&lt;1h{% endif %}
      </td>
      <td>
        <span class="status-pill s-{{ r.status }}">
          {% if r.status == 'draft' %}{{ 'Ù…Ø³ÙˆØ¯Ø©' if ar else 'Draft' }}
          {% elif r.status == 'pending' %}{{ 'Ù…Ø¹Ù„Ù‚' if ar else 'Pending' }}
          {% elif r.status == 'approved' %}{{ 'Ù…Ø¹ØªÙ…Ø¯' if ar else 'Approved' }}
          {% elif r.status == 'archived' %}{{ 'Ù…Ø¤Ø±Ø´Ù' if ar else 'Archived' }}
          {% else %}{{ r.status }}{% endif %}
        </span>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Footer -->
<div class="report-footer">
  <span>LeavePass â€” {{ 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©' if ar else 'HR Management System' }}</span>
  <span>{{ records|length }} {{ 'Ø³Ø¬Ù„' if ar else 'record(s)' }}</span>
</div>

</body>
</html>
