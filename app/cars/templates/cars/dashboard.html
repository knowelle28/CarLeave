{% extends "base.html" %}
{% block title %}{{ 'Ø­Ø¬ÙˆØ²Ø§ØªÙŠ' if session.get('lang') == 'ar' else 'My Car Bookings â€” Employee Applications Portal' }}{% endblock %}
{% block content %}
{% set ar = session.get('lang') == 'ar' %}

<div class="page-header">
  <div>
    <h1 class="page-title">{{ 'Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª' if ar else 'My Car Bookings' }}</h1>
    <p class="page-subtitle">{{ 'Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ø³ØªØ¹Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª' if ar else 'Your vehicle booking history' }}</p>
  </div>
  <a href="{{ url_for('cars.new_booking') }}" class="btn btn-primary">
    + {{ 'Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯' if ar else 'New Booking' }}
  </a>
</div>

{% if bookings %}
<div class="booking-cards">
  {% for b in bookings %}
  <div class="booking-admin-card status-border-{{ b.status }}">

    <div class="bac-header">
      <div class="bac-left">
        <span class="mono bac-number">{{ b.booking_number }}</span>
        <span class="status-badge {{ b.status_badge_class() }}">{% if b.status == 'pending' %}{{ 'Ù…Ø¹Ù„Ù‚' if ar else 'Pending' }}{% elif b.status == 'borrowed' %}{{ 'Ù…Ø³ØªØ¹Ø§Ø±' if ar else 'Borrowed' }}{% elif b.status == 'returned' %}{{ 'Ù…ÙØ¹Ø§Ø¯' if ar else 'Returned' }}{% elif b.status == 'archived' %}{{ 'Ù…Ø¤Ø±Ø´Ù' if ar else 'Archived' }}{% else %}{{ b.status }}{% endif %}</span>
      </div>
      <div class="bac-right">{{ b.planned_departure.strftime('%d %b %Y') }}</div>
    </div>

    <div class="bac-body">
      <div class="bac-section">
        <div class="bac-section-label">{{ 'Ø§Ù„Ø³ÙŠØ§Ø±Ø©' if ar else 'Vehicle' }}</div>
        <div class="bac-section-value">
          <span class="mono" style="font-weight:700;">{{ b.car.plate_number }}</span>
          <span style="color:var(--text-muted);margin-left:0.5rem;">{{ b.car.year }} {{ b.car.make }} {{ b.car.model }}</span>
        </div>
      </div>

      <div class="bac-section">
        <div class="bac-section-label">{{ 'Ø§Ù„ÙˆØ¬Ù‡Ø©' if ar else 'Destination' }}</div>
        <div class="bac-section-value">{{ b.destination or b.destination_ar or 'â€”' }}</div>
      </div>

      <div class="bac-section">
        <div class="bac-section-label">{{ 'Ø§Ù„ØºØ±Ø¶' if ar else 'Purpose' }}</div>
        <div class="bac-section-value" style="color:var(--text-muted);font-size:0.85rem;">{{ b.purpose or b.purpose_ar or 'â€”' }}</div>
      </div>

      <div class="bac-section">
        <div class="bac-section-label">{{ 'Ø§Ù„Ù…Ø¯ÙŠØ±' if ar else 'Manager' }}</div>
        <div class="bac-section-value">{{ b.manager_name or 'â€”' }}</div>
      </div>

      <div class="bac-timeline">
        <div class="bac-timeline-item">
          <span class="bac-tl-label">{{ 'Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©' if ar else 'Planned Departure' }}</span>
          <span class="bac-tl-value">{{ b.planned_departure.strftime('%d %b %Y, %I:%M %p') }}</span>
        </div>
        {% if b.actual_departure %}
        <div class="bac-timeline-item bac-tl-actual">
          <span class="bac-tl-label">{{ 'ØºØ§Ø¯Ø± ÙÙŠ' if ar else 'Borrowed At' }}</span>
          <span class="bac-tl-value">{{ b.actual_departure.strftime('%d %b %Y, %I:%M %p') }}</span>
        </div>
        {% endif %}
        {% if b.actual_return %}
        <div class="bac-timeline-item bac-tl-returned">
          <span class="bac-tl-label">{{ 'Ø£ÙØ¹ÙŠØ¯ ÙÙŠ' if ar else 'Returned At' }}</span>
          <span class="bac-tl-value">{{ b.actual_return.strftime('%d %b %Y, %I:%M %p') }}</span>
        </div>
        {% endif %}
        {% if b.odometer_return %}
        <div class="bac-timeline-item">
          <span class="bac-tl-label">{{ 'Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹' if ar else 'Odometer on Return' }}</span>
          <span class="bac-tl-value mono">{{ b.odometer_return | int }} km</span>
        </div>
        {% endif %}
      </div>

      {% if b.return_note %}
      <div style="grid-column:1/-1;">
        <div class="car-detail-return-note" style="margin-top:0;">
          <span class="car-detail-note-label">âš ï¸ {{ 'Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹' if ar else 'Driver Return Note' }}</span>
          <span>{{ b.return_note }}</span>
        </div>
      </div>
      {% endif %}
    </div>

  </div>
  {% endfor %}
</div>

{% else %}
<div class="empty-state">
  <div class="empty-icon">ğŸš—</div>
  <p>{{ 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø¨Ø¹Ø¯.' if ar else 'No bookings yet.' }}</p>
  <a href="{{ url_for('cars.new_booking') }}" class="btn btn-primary" style="margin-top:1rem;">
    {{ 'Ø§Ø¨Ø¯Ø£ Ø¨Ø­Ø¬Ø² Ø³ÙŠØ§Ø±Ø©' if ar else 'Book a Vehicle' }}
  </a>
</div>
{% endif %}
{% endblock %}
